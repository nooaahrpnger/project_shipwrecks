<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipwrecks</title>
    <link rel="stylesheet" href="styles/lookByCountry.css">
    <style>

    </style>
</head>
<body>
    <h1>Shipwrecks</h1>
    <div id="countries"></div>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    fetch("includes/get_country.php")
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(countries => {
            displayCountries(countries);
        })
        .catch(error => {
            console.error('Error fetching country list:', error);
            alert('Failed to load countries. Please check the console for details.');
        });

    function displayCountries(countries) {
        var countriesDiv = document.getElementById("countries");
        Object.keys(countries).forEach(country => {
            fetch(`https://restcountries.com/v3.1/name/${encodeURIComponent(country)}?fields=flags`)
                .then(response => response.json())
                .then(countryData => {
                    var countryCard = document.createElement("div");
                    countryCard.className = "country-card";

                    let flagURL = "images/White_flag_of_surrender.svg.png"; // Default flag
                    if (countryData[0] && countryData[0].flags && countryData[0].flags.svg) {
                        flagURL = countryData[0].flags.svg;
                    }

                    countryCard.style.backgroundImage = `url(${flagURL})`;
                    countryCard.style.backgroundSize = '100% auto'; 
                    countryCard.style.backgroundPosition = 'center';
                    countryCard.style.backgroundRepeat = 'no-repeat'; 
                    countryCard.textContent = country;
                    
                    countryCard.addEventListener("click", function() {
                        window.location.href = "index.php?page=ships&country=" + encodeURIComponent(country);
                    });

                    countriesDiv.appendChild(countryCard);
                })
                .catch(error => {
                    console.error('Error fetching flag for:', country, error);
                    // Handling if specific country data or flag is not fetched successfully
                    var countryCard = document.createElement("div");
                    countryCard.className = "country-card";
                    countryCard.style.backgroundImage = 'url("images/White_flag_of_surrender.svg.png")';
                    countryCard.style.backgroundSize = '100% auto'; 
                    countryCard.style.backgroundPosition = 'center';
                    countryCard.style.backgroundRepeat = 'no-repeat'; 
                    countryCard.textContent = country;

                    countryCard.addEventListener("click", function() {
                        window.location.href = "index.php?page=ships&country=" + encodeURIComponent(country);
                    });

                    countriesDiv.appendChild(countryCard);
                });
        });
    }
});
</script>
    
</body>
</html>
